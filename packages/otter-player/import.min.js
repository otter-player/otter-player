import{otterStyles as e}from"./otter-styles.js";const t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t);import"https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js";import"https://cdn.jsdelivr.net/npm/dashjs/dist/dash.all.min.js";class s{constructor(){this.videoElement=null,this.hls=null,this.dash=null,this.sourceUrl=null,this.poster=null,this.tracks=[],this.isPlaying=!1,this.isPaused=!0,this.spinnerElement=null}initialize(e){this.icons(),this.setupVideoElement(e),this.setupMediaSource(e),this.addOtterTracks(e.tracks),this.setupPlayPauseEvents(),this.setupPlayPauseObserver(),this.updatePlayPauseButton(),this.setupKeyboardEvents(),this.setupPoster(e.poster),this.createSpinner(),this.setupVolumeControl(),this.setupSeekBar()}icons(){this.playIcon='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M320-273v-414q0-17 12-28.5t28-11.5q5 0 10.5 1.5T381-721l326 207q9 6 13.5 15t4.5 19q0 10-4.5 19T707-446L381-239q-5 3-10.5 4.5T360-233q-16 0-28-11.5T320-273Z"/></svg>',this.pauseIcon='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M640-200q-33 0-56.5-23.5T560-280v-400q0-33 23.5-56.5T640-760q33 0 56.5 23.5T720-680v400q0 33-23.5 56.5T640-200Zm-320 0q-33 0-56.5-23.5T240-280v-400q0-33 23.5-56.5T320-760q33 0 56.5 23.5T400-680v400q0 33-23.5 56.5T320-200Z"/></svg>',this.seekLeftIcon="",this.seekRightIcon=""}setupVideoElement(e){this.videoElement=e.videoElement,this.sourceUrl=e.sourceUrl,this.poster=e.poster,this.videoElement.addEventListener("waiting",this.showLoadingSpinner.bind(this)),this.videoElement.addEventListener("loading",this.showLoadingSpinner.bind(this)),this.videoElement.addEventListener("playing",this.hideLoadingSpinner.bind(this))}setupPoster(e){this.poster&&(this.videoElement.poster=this.poster)}setupMediaSource(e){this.sourceUrl.includes(".m3u8")?this.setupHLS():this.sourceUrl.includes(".mpd")?this.setupDASH():this.videoElement.src=this.sourceUrl}setupHLS(){this.hls=new Hls,this.hls.loadSource(this.sourceUrl),this.hls.attachMedia(this.videoElement),this.hls.on(Hls.Events.LOADING,this.showLoadingSpinner.bind(this)),this.hls.on(Hls.Events.STALLED,this.showLoadingSpinner.bind(this)),this.hls.on(Hls.Events.LEVEL_LOADED,this.hideLoadingSpinner.bind(this))}setupDASH(){this.dash=dashjs.MediaPlayer().create(),this.dash.initialize(this.videoElement,this.sourceUrl,!1)}addOtterTracks(e){this.tracks=e||[],this.tracks.forEach((e=>{const t=document.createElement("track");t.src=e.src,t.kind=e.kind,t.label=e.label,t.srclang=e.srclang,this.videoElement.appendChild(t)}))}createSpinner(){const e=document.createElement("otter-spinner-container");this.spinnerElement=document.createElement("otter-spinner"),e.appendChild(this.spinnerElement),this.videoElement.parentNode.insertBefore(e,this.videoElement)}showLoadingSpinner(){this.spinnerElement&&(this.spinnerElement.style.display="flex")}hideLoadingSpinner(){this.spinnerElement&&(this.spinnerElement.style.display="none")}setupPlayPauseEvents(){this.videoElement.addEventListener("play",this.handlePlay.bind(this)),this.videoElement.addEventListener("pause",this.handlePause.bind(this))}handlePlay(){this.isPlaying=!0,this.isPaused=!1,this.updatePlayPauseButton()}handlePause(){this.isPlaying=!1,this.isPaused=!0,this.updatePlayPauseButton()}setupVolumeControl(){const e=document.querySelector("otter-volume"),t=document.createElement("input");function s(e){const t=parseFloat(e.min),s=parseFloat(e.max),n=parseFloat(e.value);e.style.backgroundSize=100*(n-t)/(s-t)+"% 100%"}t.type="range",t.min="0",t.max="1",t.step="0.01",t.addEventListener("input",(e=>{this.videoElement.volume=e.target.value,s(e.target)})),this.videoElement.addEventListener("volumechange",(()=>{t.value=this.videoElement.volume,s(t)})),e.appendChild(t)}setupSeekBar(){const e=document.querySelector("otter-seek-bar-container"),t=document.createElement("input");function s(e,s){t.value=e.toFixed(2),t.max=s.toFixed(2)}function n(e){const t=parseFloat(e.min),s=parseFloat(e.max),n=parseFloat(e.value);e.style.backgroundSize=100*(n-t)/(s-t)+"% 100%"}t.type="range",t.value="0",t.addEventListener("input",(e=>{const i=parseFloat(e.target.value);this.videoElement.currentTime=i,s(i),n(t)})),this.videoElement.addEventListener("timeupdate",(()=>{s(this.videoElement.currentTime,this.videoElement.duration),n(t)}));const i=this.videoElement.duration,a=Math.max(.1,Math.floor(i/1e3));t.min="0",t.step=a.toString(),e.appendChild(t)}setupPlayPauseObserver(){new MutationObserver((e=>{e.forEach((e=>{"attributes"===e.type&&"paused"===e.attributeName&&(this.isPaused=this.videoElement.paused,this.updatePlayPauseButton())}))})).observe(this.videoElement,{attributes:!0,attributeFilter:["paused"]})}updatePlayPauseButton(){const e=document.querySelector("otter-button[data-play-pause] button");this.isPaused?e.innerHTML=this.playIcon:e.innerHTML=this.pauseIcon}setupKeyboardEvents(){document.addEventListener("keydown",this.handleKeyboardEvent.bind(this))}handleKeyboardEvent(e){switch(e.key){case"0":this.seekToPercentage(0);break;case"1":this.seekToPercentage(10);break;case"2":this.seekToPercentage(20);break;case"3":this.seekToPercentage(30);break;case"4":this.seekToPercentage(40);break;case"5":this.seekToPercentage(50);break;case"6":this.seekToPercentage(60);break;case"7":this.seekToPercentage(70);break;case"8":this.seekToPercentage(80);break;case"9":this.seekToPercentage(90);break;case"ArrowUp":this.videoElement.volume+=.01,this.videoElement.volume>1&&(this.videoElement.volume=1);break;case"ArrowDown":this.videoElement.volume-=.01,this.videoElement.volume<0&&(this.videoElement.volume=0);break;case"j":case"ArrowLeft":this.seekLeft(10);break;case"l":case"ArrowRight":this.seekRight(10);break;case" ":case"k":case"p":this.togglePausePlay()}}play(){this.videoElement.play()}pause(){this.videoElement.pause()}seek(e){this.videoElement.currentTime=e}seekLeft(e){this.seek(this.videoElement.currentTime-e)}seekRight(e){this.seek(this.videoElement.currentTime+e)}seekToPercentage(e){this.seek(this.videoElement.duration*(e/100))}togglePausePlay(){this.isPaused?this.play():this.pause()}}const n=document.querySelector("otter");if(n){const e=document.querySelector("otter-layout"),t=document.createElement("otter-player"),i=document.createElement("video");t.appendChild(i),e.appendChild(t);const a=document.createElement("otter-structure"),o=document.createElement("otter-top"),r=document.createElement("otter-title");r.innerText=n.getAttribute("title"),o.appendChild(r);const l=document.createElement("otter-center"),d=document.createElement("otter-bottom"),h=document.createElement("otter-volume"),c=document.createElement("otter-controls"),u=document.createElement("otter-button"),p=document.createElement("button");p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentcolor"><path d="M420-320h-90q-13 0-21.5-8.5T300-350q0-13 8.5-21.5T330-380h70v-40h-40q-8 0-14-6t-6-14q0-8 6-14t14-6h40v-40h-70q-13 0-21.5-8.5T300-530q0-13 8.5-21.5T330-560h90q17 0 28.5 11.5T460-520v160q0 17-11.5 28.5T420-320Zm120 0q-17 0-28.5-11.5T500-360v-160q0-17 11.5-28.5T540-560h80q17 0 28.5 11.5T660-520v160q0 17-11.5 28.5T620-320h-80Zm20-60h40v-120h-40v120ZM480-80q-75 0-140.5-28.5t-114-77q-48.5-48.5-77-114T120-440q0-17 11.5-28.5T160-480q17 0 28.5 11.5T200-440q0 117 81.5 198.5T480-160q117 0 198.5-81.5T760-440q0-117-81.5-198.5T480-720h-6l34 34q12 12 11.5 28T508-630q-12 12-28.5 12.5T451-629L348-732q-12-12-12-28t12-28l103-103q12-12 28.5-11.5T508-890q11 12 11.5 28T508-834l-34 34h6q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-440q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T480-80Z"/></svg>',u.appendChild(p),u.setAttribute("data-seek-left","");const m=document.createElement("otter-button");m.setAttribute("data-play-pause","");const v=document.createElement("button");m.appendChild(v);const E=document.createElement("otter-button"),g=document.createElement("button");g.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentcolor"><path d="M480-80q-75 0-140.5-28.5t-114-77q-48.5-48.5-77-114T120-440q0-75 28.5-140.5t77-114q48.5-48.5 114-77T480-800h6l-34-34q-12-12-11.5-28t11.5-28q12-12 28.5-12.5T509-891l103 103q12 12 12 28t-12 28L509-629q-12 12-28.5 11.5T452-630q-11-12-11.5-28t11.5-28l34-34h-6q-117 0-198.5 81.5T200-440q0 117 81.5 198.5T480-160q117 0 198.5-81.5T760-440q0-17 11.5-28.5T800-480q17 0 28.5 11.5T840-440q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T480-80Zm-60-240h-90q-13 0-21.5-8.5T300-350q0-13 8.5-21.5T330-380h70v-40h-40q-8 0-14-6t-6-14q0-8 6-14t14-6h40v-40h-70q-13 0-21.5-8.5T300-530q0-13 8.5-21.5T330-560h90q17 0 28.5 11.5T460-520v160q0 17-11.5 28.5T420-320Zm120 0q-17 0-28.5-11.5T500-360v-160q0-17 11.5-28.5T540-560h80q17 0 28.5 11.5T660-520v160q0 17-11.5 28.5T620-320h-80Zm20-60h40v-120h-40v120Z"/></svg>',E.appendChild(g),E.setAttribute("data-seek-right","");const T=document.createElement("otter-controls-play-pause");T.appendChild(m),c.appendChild(u),c.appendChild(T),c.appendChild(E);const q=document.createElement("otter-brightness"),k=document.createElement("input");k.type="range",k.min="0",k.max="1",k.step="0.1",k.value="1",q.appendChild(k),l.appendChild(h),l.appendChild(c),l.appendChild(q),a.appendChild(o),a.appendChild(l);const b=document.createElement("otter-seek-bar-container");d.appendChild(b),a.appendChild(d),e.appendChild(a),n.appendChild(e);const y=JSON.parse(n.getAttribute("tracks")||"[]"),P=new s;P.initialize({videoElement:i,sourceUrl:n.getAttribute("src"),tracks:y,poster:n.getAttribute("poster")}),u.addEventListener("click",(()=>P.seekLeft(30))),m.addEventListener("click",(()=>{P.togglePausePlay()})),E.addEventListener("click",(()=>P.seekRight(30)))}function i(e){let t=e.target;"range"!==e.target.type&&(t=document.getElementById("range"));const s=t.min,n=t.max,i=t.value;t.style.backgroundSize=100*(i-s)/(n-s)+"% 100%"}document.querySelectorAll('input[type="range"]').forEach((e=>{e.addEventListener("input",i)}));